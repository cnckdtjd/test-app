<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout :: head('테스트 데이터 관리')"></head>
<body>
    <header th:replace="fragments/layout :: header"></header>
    
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-2 d-none d-md-block sidebar">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="/admin-service/dashboard">
                                <i class="fas fa-tachometer-alt"></i> 대시보드
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin-service/users">
                                <i class="fas fa-users"></i> 회원 관리
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin-service/products">
                                <i class="fas fa-box"></i> 상품 관리
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin-service/orders">
                                <i class="fas fa-shopping-cart"></i> 주문 관리
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin-service/statistics">
                                <i class="fas fa-chart-bar"></i> 통계
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/admin-service/test-data">
                                <i class="fas fa-database"></i> 테스트 데이터
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <main role="main" class="col-md-10 ml-sm-auto px-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">테스트 데이터 관리</h1>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> 테스트 데이터를 생성하거나 초기화합니다. 데이터를 초기화하면 모든 테스트 데이터가 삭제되니 주의하세요.
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3>테스트 데이터 생성</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="userCount">회원 수</label>
                                    <input type="number" id="userCount" class="form-control" value="100" min="1" max="1000">
                                </div>
                                <div class="form-group">
                                    <label for="productCount">상품 수</label>
                                    <input type="number" id="productCount" class="form-control" value="200" min="1" max="1000">
                                </div>
                                <div class="form-group">
                                    <label for="orderCount">주문 수</label>
                                    <input type="number" id="orderCount" class="form-control" value="300" min="1" max="1000">
                                </div>
                                <div class="form-group">
                                    <label for="cartCount">장바구니 수</label>
                                    <input type="number" id="cartCount" class="form-control" value="150" min="1" max="1000">
                                </div>
                                <div class="form-group">
                                    <button id="generateDataBtn" class="btn btn-primary">테스트 데이터 생성</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3>데이터 초기화</h3>
                            </div>
                            <div class="card-body">
                                <div class="test-data-types">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="resetUsers" checked>
                                        <label class="form-check-label" for="resetUsers">회원 데이터</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="resetProducts" checked>
                                        <label class="form-check-label" for="resetProducts">상품 데이터</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="resetOrders" checked>
                                        <label class="form-check-label" for="resetOrders">주문 데이터</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="resetCarts" checked>
                                        <label class="form-check-label" for="resetCarts">장바구니 데이터</label>
                                    </div>
                                </div>
                                <div class="form-group mt-4">
                                    <button id="resetDataBtn" class="btn btn-danger">데이터 초기화</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h3>데이터 현황</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>데이터 종류</th>
                                                <th>개수</th>
                                                <th>마지막 갱신</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>회원</td>
                                                <td id="userDataCount">0</td>
                                                <td id="userDataUpdated">-</td>
                                            </tr>
                                            <tr>
                                                <td>상품</td>
                                                <td id="productDataCount">0</td>
                                                <td id="productDataUpdated">-</td>
                                            </tr>
                                            <tr>
                                                <td>주문</td>
                                                <td id="orderDataCount">0</td>
                                                <td id="orderDataUpdated">-</td>
                                            </tr>
                                            <tr>
                                                <td>장바구니</td>
                                                <td id="cartDataCount">0</td>
                                                <td id="cartDataUpdated">-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h3>작업 로그</h3>
                            </div>
                            <div class="card-body">
                                <pre id="logOutput" class="log-output"></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 데이터 현황 로드
            loadDataStatus();
            
            // 테스트 데이터 생성
            document.getElementById('generateDataBtn').addEventListener('click', generateTestData);
            
            // 데이터 초기화
            document.getElementById('resetDataBtn').addEventListener('click', resetTestData);
        });
        
        async function loadDataStatus() {
            try {
                const response = await fetch('/admin-service/api/admin/test-data/status');
                
                if (!response.ok) {
                    throw new Error('데이터 현황을 불러오는데 실패했습니다.');
                }
                
                const data = await response.json();
                
                document.getElementById('userDataCount').textContent = data.userCount.toLocaleString();
                document.getElementById('productDataCount').textContent = data.productCount.toLocaleString();
                document.getElementById('orderDataCount').textContent = data.orderCount.toLocaleString();
                document.getElementById('cartDataCount').textContent = data.cartCount.toLocaleString();
                
                document.getElementById('userDataUpdated').textContent = formatDate(data.userUpdated);
                document.getElementById('productDataUpdated').textContent = formatDate(data.productUpdated);
                document.getElementById('orderDataUpdated').textContent = formatDate(data.orderUpdated);
                document.getElementById('cartDataUpdated').textContent = formatDate(data.cartUpdated);
                
            } catch (error) {
                console.error('Error:', error);
                appendLog('오류: ' + error.message);
            }
        }
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleString();
        }
        
        async function generateTestData() {
            if (!confirm('테스트 데이터를 생성하시겠습니까?')) {
                return;
            }
            
            const userCount = document.getElementById('userCount').value;
            const productCount = document.getElementById('productCount').value;
            const orderCount = document.getElementById('orderCount').value;
            const cartCount = document.getElementById('cartCount').value;
            
            appendLog('테스트 데이터 생성 시작...');
            
            try {
                const response = await fetch('/admin-service/api/admin/test-data/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userCount: parseInt(userCount),
                        productCount: parseInt(productCount),
                        orderCount: parseInt(orderCount),
                        cartCount: parseInt(cartCount)
                    })
                });
                
                if (!response.ok) {
                    throw new Error('테스트 데이터 생성에 실패했습니다.');
                }
                
                appendLog('테스트 데이터 생성 완료!');
                loadDataStatus();
                
            } catch (error) {
                console.error('Error:', error);
                appendLog('오류: ' + error.message);
            }
        }
        
        async function resetTestData() {
            if (!confirm('선택한 데이터를 초기화하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                return;
            }
            
            const resetUsers = document.getElementById('resetUsers').checked;
            const resetProducts = document.getElementById('resetProducts').checked;
            const resetOrders = document.getElementById('resetOrders').checked;
            const resetCarts = document.getElementById('resetCarts').checked;
            
            if (!resetUsers && !resetProducts && !resetOrders && !resetCarts) {
                alert('초기화할 데이터를 선택해주세요.');
                return;
            }
            
            appendLog('데이터 초기화 시작...');
            
            try {
                const response = await fetch('/admin-service/api/admin/test-data/reset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        resetUsers,
                        resetProducts,
                        resetOrders,
                        resetCarts
                    })
                });
                
                if (!response.ok) {
                    throw new Error('데이터 초기화에 실패했습니다.');
                }
                
                appendLog('데이터 초기화 완료!');
                loadDataStatus();
                
            } catch (error) {
                console.error('Error:', error);
                appendLog('오류: ' + error.message);
            }
        }
        
        function appendLog(message) {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            logOutput.innerHTML += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
    </script>
    
    <style>
        /* 사이드바 스타일 (기존과 동일) */
        .sidebar {
            position: fixed;
            top: 72px;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 20px 0;
            background-color: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }
        
        .sidebar-sticky {
            position: sticky;
            top: 0;
            height: calc(100vh - 72px);
            overflow-y: auto;
        }
        
        .sidebar .nav-link {
            font-weight: 500;
            color: var(--text-color);
            padding: 0.75rem 1rem;
        }
        
        .sidebar .nav-link:hover {
            background-color: var(--medium-gray);
        }
        
        .sidebar .nav-link.active {
            color: var(--primary-color);
            background-color: rgba(66, 133, 244, 0.1);
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        
        /* 메인 컨텐츠 스타일 */
        main {
            margin-top: 72px;
            padding-bottom: 50px;
        }
        
        /* 테스트 데이터 스타일 */
        .test-data-types {
            margin-bottom: 20px;
        }
        
        .form-check {
            margin-bottom: 10px;
        }
        
        .log-output {
            height: 300px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</body>
</html> 