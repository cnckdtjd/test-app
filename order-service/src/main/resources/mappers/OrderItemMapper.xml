<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jacob.orderservice.repository.OrderItemMapper">

    <!-- 결과 매핑 정의 -->
    <resultMap id="orderItemResultMap" type="com.jacob.orderservice.model.OrderItem">
        <id property="id" column="id"/>
        <result property="orderId" column="order_id"/>
        <result property="productId" column="product_id"/>
        <result property="productName" column="product_name"/>
        <result property="productImage" column="product_image"/>
        <result property="price" column="price"/>
        <result property="quantity" column="quantity"/>
        <result property="productOption" column="product_option"/>
    </resultMap>

    <!-- 공통 컬럼 -->
    <sql id="orderItemColumns">
        id, order_id, product_id, product_name, product_image, price, quantity, product_option
    </sql>

    <!-- 조회 쿼리 -->
    <select id="findById" resultMap="orderItemResultMap">
        SELECT 
            <include refid="orderItemColumns" />
        FROM 
            order_items
        WHERE 
            id = #{id}
    </select>

    <select id="findByOrderId" resultMap="orderItemResultMap">
        SELECT 
            <include refid="orderItemColumns" />
        FROM 
            order_items
        WHERE 
            order_id = #{orderId}
    </select>

    <!-- 생성 및 수정 쿼리 -->
    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO order_items (
            order_id, product_id, product_name, product_image, price, quantity, product_option
        ) VALUES (
            #{orderId}, #{productId}, #{productName}, #{productImage}, #{price}, #{quantity}, #{productOption}
        )
    </insert>

    <insert id="saveAll">
        INSERT INTO order_items (
            order_id, product_id, product_name, product_image, price, quantity, product_option
        ) VALUES
        <foreach collection="orderItems" item="item" separator=",">
            (#{item.orderId}, #{item.productId}, #{item.productName}, #{item.productImage}, #{item.price}, #{item.quantity}, #{item.productOption})
        </foreach>
    </insert>

    <update id="update">
        UPDATE order_items
        SET 
            product_id = #{productId},
            product_name = #{productName},
            product_image = #{productImage},
            price = #{price},
            quantity = #{quantity},
            product_option = #{productOption}
        WHERE 
            id = #{id}
    </update>

    <!-- 삭제 쿼리 -->
    <delete id="deleteById">
        DELETE FROM order_items WHERE id = #{id}
    </delete>

    <delete id="deleteByOrderId">
        DELETE FROM order_items WHERE order_id = #{orderId}
    </delete>
</mapper> 